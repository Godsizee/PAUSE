@media print {
    body {
        padding-top: 0 !important;
        background-color: #fff !important; /* Force white background */
        color: #000 !important; /* Force black text */
        font-size: 7pt !important; /* FURTHER REDUCED base font size */
        line-height: 1.1 !important; /* FURTHER TIGHTENED line height */
        -webkit-print-color-adjust: exact !important; /* Ensure background/colors print */
        print-color-adjust: exact !important;
    }

    /* Hide non-printable elements */
    .page-header,
    .site-footer,
    .dashboard-sidebar-content, /* Student/Teacher sidebar */
    .planer-header,
    .bulk-actions-controls,
    .print-export-actions, /* Hide the print/pdf buttons themselves */
    .modal-overlay,
    .toast-notification,
    .ical-subscription-box,
    .my-day-section, /* Hide "Mein Tag" section */
    .section-divider,
    #imprint-details {
        display: none !important;
        visibility: hidden !important;
    }

    /* Adjust main content area */
    .page-wrapper {
        max-width: none !important;
        padding: 5mm !important; /* Keep reduced margin */
        margin: 0 !important;
        box-shadow: none !important;
        border: none !important;
    }
    .dashboard-container,
    .dashboard-main-content,
    .dashboard-section,
    .timetable-container {
        display: block !important; /* Override grid/flex */
        width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
        box-shadow: none !important;
        border: none !important;
        background-color: transparent !important;
    }

    /* Title before the timetable */
    .dashboard-header .section-title, /* Keep title */
    #plan-header-info { /* Keep subtitle */
        display: block !important;
        text-align: center !important;
        margin-bottom: 3mm !important; /* Slightly reduced margin */
        border-bottom: none !important;
        padding-bottom: 0 !important;
        font-size: 10pt !important; /* FURTHER REDUCED font size */
        color: #000 !important;
        page-break-after: avoid; /* Prevent break after header */
    }
     .dashboard-header .plan-controls {
         display: none !important; /* Hide week selectors in print */
     }

    /* Style the timetable grid for print */
    .timetable-grid {
        display: grid !important;
        grid-template-columns: 40px repeat(5, 1fr) !important; /* FURTHER REDUCED time column width */
        grid-auto-rows: minmax(18mm, auto); /* ADDED: Try to constrain row height */
        gap: 0.5px !important; /* Keep reduced lines */
        border: 0.5px solid #aaa !important; /* Keep thinner border */
        background-color: #aaa !important;
        overflow: hidden !important; /* CHANGE: Hide overflow instead of visible */
        page-break-inside: avoid !important; /* *** CRITICAL: Try to keep table on one page *** */
    }

    .grid-header,
    .grid-cell {
        padding: 1px !important; /* FURTHER REDUCED padding */
        border: none !important; /* Borders handled by grid gap */
        background-color: #fff !important;
        color: #000 !important;
        font-size: 6pt !important; /* FURTHER REDUCED font size */
        line-height: 1.0 !important; /* FURTHER TIGHTENED line height */
        overflow: hidden !important; /* *** Ensure content clipping *** */
        page-break-inside: avoid !important; /* Prevent breaks inside cells */
        word-wrap: break-word; /* Allow text wrapping */
        display: flex; /* ADDED: Use flex for better vertical alignment */
        flex-direction: column; /* ADDED: Stack content vertically */
        justify-content: center; /* ADDED: Center content vertically */
    }

    .grid-header {
        font-weight: bold;
        background-color: #f0f0f0 !important; /* Slightly lighter gray */
    }
    .grid-header.period-header {
        font-size: 5pt !important; /* FURTHER REDUCED font size */
        white-space: normal; /* Allow time to wrap if needed */
        text-align: center;
        padding: 1px 0 !important; /* Minimal vertical padding */
    }

    .cell-entry {
        background-color: transparent !important;
        border: none !important;
        padding: 0 !important; /* No padding needed within flex */
        font-size: inherit !important;
        color: inherit !important;
        text-decoration: none !important; /* Remove strikethrough for Entfall */
        opacity: 1 !important;
        height: auto !important;
        min-height: 0 !important;
        /* align-items: center !important; */ /* Controlled by parent flex */
        display: block !important; /* Allow content to flow naturally */
        text-align: center;
        overflow: hidden; /* Hide overflow within the entry itself */
    }

    .grid-cell strong { font-size: 6pt !important; font-weight: bold !important; display: block; margin-bottom: 0px; line-height: 1.1; }
    .grid-cell span { font-size: 5pt !important; color: #333 !important; display: block; line-height: 1.1; }
    .grid-cell small { font-size: 4pt !important; color: #555 !important; display: block; white-space: normal; line-height: 1.1; } /* Allow comments to wrap */
    .grid-cell small.entry-comment { font-style: italic; }

    /* Remove specific background colors, keep borders */
    .grid-cell.substitution-Vertretung,
    .grid-cell.substitution-Raum채nderung,
    .grid-cell.substitution-Sonderevent,
    .grid-cell.substitution-Entfall {
        background-color: #fff !important;
        border-left-width: 2px !important; /* THINNER left border */
        border-left-style: solid !important;
        padding-left: 1px !important; /* Adjust padding slightly */
    }
    .grid-cell.substitution-Vertretung { border-left-color: #dc3545 !important; }
    .grid-cell.substitution-Raum채nderung { border-left-color: #ffc107 !important; }
    .grid-cell.substitution-Sonderevent { border-left-color: #0d6efd !important; }
    .grid-cell.substitution-Entfall { border-left-color: #6c757d !important; }

    /* Add "Entf채llt" text again, since strikethrough is removed */
     .grid-cell.substitution-Entfall .cell-entry strong::before { /* Add before subject */
         content: "Entf채llt: ";
         font-weight: bold;
         color: #6c757d;
     }
     /* Hide other details for cancellation */
     .grid-cell.substitution-Entfall .cell-entry span,
     .grid-cell.substitution-Entfall .cell-entry small.entry-room {
          display: none;
     }


    /* Hide empty cell content placeholder (like FU) if not needed */
    .grid-cell.default-entry .cell-entry {
        display: none; /* Hide FU text */
    }
    /* Make empty cells visually smaller if needed */
    .grid-cell.empty {
        background-color: #fdfdfd !important; /* Slightly off-white */
        min-height: 1.5em; /* Set a minimal height */
        padding: 0 !important; /* Remove padding */
    }


     /* Ensure links are printed (optional) */
     a[href^="http"]::after {
         /* content: " (" attr(href) ")"; */ /* Uncomment to print URLs */
         font-size: 5pt;
         color: #555;
     }

     /* Avoid page breaks inside cells or headers - already set above */
     /* .grid-header, .grid-cell, .cell-entry { page-break-inside: avoid; } */

     /* Add a title at the top of the printed page */
     @page {
         margin: 8mm !important; /* FURTHER REDUCED margins */
         size: A4 landscape !important; /* Ensure landscape */
     }

     /* Add print info header - needs JS to update content dynamically */
     #print-header-info {
         display: block !important;
         text-align: center;
         margin-bottom: 3mm; /* Keep reduced margin */
         font-weight: bold;
         font-size: 10pt !important; /* Keep reduced font size */
         page-break-after: avoid;
     }

} /* End @media print */

/* Specific styles for the Print/Export buttons container */
.print-export-actions {
    display: flex;
    gap: 10px;
    align-items: flex-end; /* Align with other controls */
    margin-left: auto; /* Push to the right in planer dashboard */
}
.print-export-actions .btn-small {
    padding: 6px 12px;
    font-size: 0.85rem;
    height: 38px; /* Match other control heights */
    width: auto;
    display: inline-flex;
    gap: 6px;
    align-items: center;
    background-color: #f8f9fa;
    color: var(--color-text);
    border: 1px solid var(--color-border);
    margin-bottom: 0;
}
.print-export-actions .btn-small:hover {
    background-color: #e9ecef;
    color: var(--color-primary);
}
.dark-mode .print-export-actions .btn-small {
    background-color: var(--color-surface-alt);
    color: var(--color-text);
    border-color: var(--color-border);
}
.dark-mode .print-export-actions .btn-small:hover {
    background-color: #343a40;
    color: var(--color-primary);
}
.print-export-actions .btn-small svg {
    margin-top: -2px; /* Visual alignment */
}

/* Hide print/export for Admin */
body.role-admin .print-export-actions {
    display: none !important;
}

